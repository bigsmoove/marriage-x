# ðŸ”’ Secure PDF Setup Required

## Action Needed Before Testing

You need to upload your PDF files to **Supabase Storage** (not public folder anymore). This keeps your PDFs secure and only accessible via token-based downloads.

### Your Existing PDFs

You have:
- `10WaysToRevitalizeYourMarriage-Top10-revised.pdf` (free version)
- Premium 25-ways version (if available)

### Steps to Upload PDFs to Supabase

1. **Set Up Supabase Storage Bucket**:
   - Follow instructions in `SUPABASE_SETUP.md`
   - Create private bucket named `marriage-pdfs`
   - Set up RLS policies

2. **Upload Your PDFs**:
   - Go to Supabase Dashboard â†’ Storage â†’ `marriage-pdfs` bucket
   - Click "Upload file"
   - Upload and rename to exact filenames:
     - `10-ways-revitalize-marriage.pdf` (free version)
     - `25-ways-revitalize-marriage.pdf` (premium version)

3. **Verify Upload**:
   - Check files are in the bucket
   - Try accessing them directly (should fail - they're private!)
   - Only signed URLs generated by the app should work

### Environment Variables Needed

Make sure these are in your `.env.local`:

```bash
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
NEXT_PUBLIC_SUPABASE_BUCKET=marriage-pdfs
PDF_FREE_FILENAME=10-ways-revitalize-marriage.pdf
PDF_PREMIUM_FILENAME=25-ways-revitalize-marriage.pdf
STRIPE_PRICE_ID_PREMIUM=price_1Smx1jRdLjhk4cyD5tR3xqlR
```

### Testing After Upload

Once PDFs are uploaded to Supabase:

1. Start the dev server: `npm run dev`
2. Test free email capture â†’ Check email â†’ Click download link
3. Test premium purchase â†’ Complete checkout â†’ Check email â†’ Click download link
4. Verify PDFs download successfully with signed URLs
5. Verify direct access to PDFs fails (security working!)

### For Deployment

When deploying to Vercel:
1. PDFs remain in Supabase Storage (already uploaded)
2. Set all environment variables in Vercel dashboard
3. No need to deploy PDFs with code
4. Supabase handles secure distribution via CDN

### Security Benefits

âœ… PDFs never publicly accessible  
âœ… Token-based access control  
âœ… Time-limited download URLs (48 hours)  
âœ… Audit trail of all downloads  
âœ… Can revoke access by invalidating tokens  

---

**Important:** PDFs are now stored securely in Supabase Storage, not in your repository!

